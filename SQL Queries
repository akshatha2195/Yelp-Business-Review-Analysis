1.Find the no of businesses in each category 

with cte as (select business_id,trim(a.value) as category from tbl_yelp_business ,lateral split_to_table(categories,',') a   )

select count(*),category from cte group by category  order by   count(*) desc 

2.find the top 10 users who have reviewd the most businesses in "Restuarant" Category 

with cte as (select 
r.user_id ,count(distinct r.business_id) as b ,dense_rank() over(order by count(r.business_id) desc ) as rnk 

from tbl_yelp_reviews r join tbl_yelp_business b on r.business_id=b.business_id
where categories ilike '%restaurants%' group by r.user_id)
select user_id,b from cte where rnk<=10 order by b desc 

3.Find the most popular categories of businesses (based on  no of reviews)

with cte as (select business_id,trim(a.value) as category from tbl_yelp_business ,lateral split_to_table(categories,',') a   )

select count(*),category from cte  join tbl_yelp_reviews r on cte.business_id=r.business_id
group by category  order by   count(*) desc 


4.Find the top 3 most recent reviews for each business 

with cte as (select r.business_id,b.bname, r.review_text,r.review_date,
dense_rank() over(partition by r.business_id order by r.review_date desc ) as rnk 
from tbl_yelp_reviews r join tbl_yelp_business b on r.business_id=b.business_id )

select c.business_id,c.bname, c.review_text,review_date from cte c where rnk<=3

5.find the month with highest no of reviews 

select month(review_date) as mon ,count(*) from tbl_yelp_reviews group by mon order by count(*) desc limit 1

